<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ambulance Priority Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa7bf; --accent:#22c55e; --danger:#ef4444; --warn:#f59e0b; --glass: rgba(255,255,255,0.03);
      --soft:#111827; --glass-2: rgba(255,255,255,0.02);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#071029 0%, #071827 100%);color:#e6eef8}
    .container{max-width:1200px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    .brand{display:flex;flex-direction:column}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin-top:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}

    .status-card{grid-column:span 4}
    .main-card{grid-column:span 8}
    .full{grid-column:1 / -1}

    .lane-title{display:flex;justify-content:space-between;align-items:center}
    .lane-title h3{margin:0;font-size:14px}
    .lane-count{font-size:28px;font-weight:700}

    .led{width:14px;height:14px;border-radius:50%;display:inline-block;margin-right:8px;box-shadow:0 0 8px rgba(0,0,0,0.4)}
    .led.green{background:var(--accent);box-shadow:0 0 18px rgba(34,197,94,0.2)}
    .led.red{background:var(--danger);box-shadow:0 0 18px rgba(239,68,68,0.2)}
    .led.yellow{background:var(--warn);box-shadow:0 0 18px rgba(245,158,11,0.12)}

    .muted{color:var(--muted);font-size:13px}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="width:48px;height:48px;border-radius:10px;background:linear-gradient(180deg,#0ea5a9,#0284c7);display:flex;align-items:center;justify-content:center;font-weight:700">AI</div>
      <div class="brand">
        <h1>Ambulance Priority — Real-time Dashboard</h1>
        <p class="lead">Live visualization of lane state, vehicle counts, CO₂ estimate and routing recommendations.</p>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="small muted">Connection:</div>
        <div id="conn" style="font-weight:700;color:#7dd3fc">DISCONNECTED</div>
      </div>
    </header>

    <div class="grid">
      <div class="card status-card">
        <div class="lane-title"><h3>Main Lane</h3><div class="small muted">Primary traffic</div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div>
            <div class="lane-count" id="mainCount">0</div>
            <div class="muted">Vehicles currently in main lane</div>
          </div>
          <div style="text-align:right">
            <div><span id="mainLed" class="led green"></span><span id="mainState">OK</span></div>
          </div>
        </div>
      </div>

      <div class="card status-card">
        <div class="lane-title"><h3>Green Corridor</h3><div class="small muted">Alternate route</div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div>
            <div class="lane-count" id="corridorCount">0</div>
            <div class="muted">Vehicles in corridor</div>
          </div>
          <div style="text-align:right">
            <div><span id="corridorLed" class="led red"></span><span id="corrState">CLOSED</span></div>
          </div>
        </div>
      </div>

      <div class="card status-card">
        <div class="lane-title"><h3>Emergency Lane</h3><div class="small muted">Ambulance only</div></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div>
            <div class="lane-count" id="ambCount">0</div>
            <div class="muted">Ambulances detected</div>
          </div>
          <div style="text-align:right">
            <div><span id="ambLed" class="led green"></span><span id="ambState">Idle</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ---- UI elements ----
    const connEl = document.getElementById('conn');
    const mainCountEl = document.getElementById('mainCount');
    const corridorCountEl = document.getElementById('corridorCount');
    const ambCountEl = document.getElementById('ambCount');
    const mainLed = document.getElementById('mainLed');
    const corridorLed = document.getElementById('corridorLed');
    const ambLed = document.getElementById('ambLed');
    const mainState = document.getElementById('mainState');
    const corrState = document.getElementById('corrState');
    const ambState = document.getElementById('ambState');

    const vehiclesChart = new Chart(document.createElement('canvas').getContext('2d'), {
      type:'line',
      data:{labels:[], datasets:[
        {label:'Main lane', data:[], borderColor:'#60a5fa', fill:false, tension:0.3},
        {label:'Green corridor', data:[], borderColor:'#34d399', fill:false, tension:0.3},
        {label:'Ambulance', data:[], borderColor:'#f97316', fill:false, tension:0.3}
      ]},
      options:{responsive:true, plugins:{legend:{labels:{color:'#c7d2fe'}}}, scales:{x:{ticks:{color:'#9aa7bf'}}, y:{ticks:{color:'#9aa7bf'}}}}
    });

    // ---- Helpers ----
    function setLed(el,color){
      el.classList.remove('green','red','yellow');
      if(color==='green') el.classList.add('green');
      if(color==='red') el.classList.add('red');
      if(color==='yellow') el.classList.add('yellow');
    }

    function updateUI(data){
      // تحديث counts
      mainCountEl.textContent = data.main || 0;
      corridorCountEl.textContent = data.corridor || 0;
      ambCountEl.textContent = data.amb || 0;

      // LEDs و status
      if(data.main>8){ setLed(mainLed,'red'); mainState.textContent='CONGESTED'; }
      else{ setLed(mainLed,'green'); mainState.textContent='OK'; }

      if(data.corridor_open){ setLed(corridorLed,'green'); corrState.textContent='OPEN'; }
      else{ setLed(corridorLed,'red'); corrState.textContent='CLOSED'; }

      if(data.amb>0){ setLed(ambLed,'green'); ambState.textContent='ACTIVE'; }
      else{ setLed(ambLed,'green'); ambState.textContent='Idle'; }

      // Chart (اختياري)
      const label = new Date().toLocaleTimeString();
      vehiclesChart.data.labels.push(label);
      vehiclesChart.data.datasets[0].data.push(data.main || 0);
      vehiclesChart.data.datasets[1].data.push(data.corridor || 0);
      vehiclesChart.data.datasets[2].data.push(data.amb || 0);
      if(vehiclesChart.data.labels.length>30){ 
        vehiclesChart.data.labels.shift(); 
        vehiclesChart.data.datasets.forEach(ds=>ds.data.shift()); 
      }
      vehiclesChart.update();
    }

    // ---- Fetch data from Flask every 1 second ----
    const FLASK_URL = "https://janaali.pythonanywhere.com/data";

    async function fetchFlaskData(){
      try{
        const resp = await fetch(FLASK_URL);
        const data = await resp.json();
        updateUI(data);
        connEl.textContent = "CONNECTED";
        connEl.style.color = "#86efac";
      }catch(err){
        connEl.textContent = "DISCONNECTED";
        connEl.style.color = "#7dd3fc";
        console.error("Error fetching Flask data:", err);
      }
    }

    setInterval(fetchFlaskData, 1000); // كل ثانية
    window.onload = fetchFlaskData;

  </script>
</body>
</html>


