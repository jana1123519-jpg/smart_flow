<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Traffic Monitoring Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#22c55e;
      --danger:#ef4444;
      font-family: Inter, system-ui, sans-serif;
    }
    body{
      margin:0;
      background:linear-gradient(180deg,#071029 0%, #071827 100%);
      color:#e6eef8;
    }
    .container{
      max-width:1000px;
      margin:30px auto;
      padding:20px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:30px;
    }
    h1{margin:0;font-size:22px;}
    .status{font-weight:700;}
    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:20px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:20px;
      box-shadow:0 8px 20px rgba(0,0,0,0.4);
      text-align:center;
    }
    .card h3{
      margin:0;
      font-size:14px;
      color:var(--muted);
    }
    .value{
      margin-top:10px;
      font-size:32px;
      font-weight:700;
    }
    .normal{color:#22c55e;}
    .warn{color:#f59e0b;}
    .danger{color:#ef4444;}
  </style>
</head>

<body>
<div class="container">

  <header>
    <h1>ðŸš¦ AI Traffic Monitoring Dashboard</h1>
    <div id="conn" class="status" style="color:#ef4444">DISCONNECTED</div>
  </header>

  <div class="grid">
    <div class="card">
      <h3>Cars Detected</h3>
      <div id="carsDetected" class="value">-</div>
    </div>

    <div class="card">
      <h3>Emergency Vehicle</h3>
      <div id="emergencyStatus" class="value">-</div>
    </div>

    <div class="card">
      <h3>Congestion Status</h3>
      <div id="congestionStatus" class="value">-</div>
    </div>
  </div>

</div>

<script>
const FLASK_URL = "https://janaali.pythonanywhere.com/data";

const connEl = document.getElementById("conn");
const carsEl = document.getElementById("carsDetected");
const emergencyEl = document.getElementById("emergencyStatus");
const congestionEl = document.getElementById("congestionStatus");

let lastValidData = null;

async function fetchData(){
  try{
    const resp = await fetch(FLASK_URL, { cache: "no-store" });
    const data = await resp.json();

    if (!data || data.road_1 === undefined) return;

    const totalCars = data.road_1 + data.road_2 + data.road_3;

    // Reject fake/default data
    if (totalCars === 0 && !data.emergency) {
      connEl.textContent = "DISCONNECTED";
      connEl.style.color = "#ef4444";
      return;
    }

    // REAL DATA
    connEl.textContent = "CONNECTED";
    connEl.style.color = "#22c55e";

    carsEl.textContent = totalCars;

    emergencyEl.textContent = data.emergency ? "YES" : "NO";
    emergencyEl.className = "value " + (data.emergency ? "danger" : "normal");

    if (totalCars > 10) {
      congestionEl.textContent = "HIGHLY CONGESTED";
      congestionEl.className = "value danger";
    } else if (totalCars > 6) {
      congestionEl.textContent = "CONGESTED";
      congestionEl.className = "value warn";
    } else {
      congestionEl.textContent = "NORMAL";
      congestionEl.className = "value normal";
    }

    lastValidData = data;

  } catch {
    connEl.textContent = "DISCONNECTED";
    connEl.style.color = "#ef4444";
  }
}

setInterval(fetchData, 1000);
fetchData();
</script>

</body>
</html>
